---
import { useState } from "solid-js";
import { useNavigate } from "@solidjs/router";
import { ref, push, set } from "firebase/database";
import { db } from "../../lib/firebase";
---

<script type="module">
  import { createSignal } from "solid-js";
  import { useNavigate } from "@solidjs/router";
  import { db } from "../../lib/firebase";
  import { ref, push, set } from "firebase/database";

  const [name, setName] = createSignal("");
  const [sessionId, setSessionId] = createSignal("");
  const navigate = useNavigate();

  const handleJoin = async () => {
    if (!name().trim() || !sessionId().trim()) return;

    const playerRef = push(ref(db, `sessions/${sessionId()}/players`));
    await set(playerRef, {
      name: name(),
      responded: false,
      readyNextRound: false,
    });

    const playerId = playerRef.key;
    // Navigate with playerId in URL
    navigate(`/prompt-quest/game/${sessionId()}?playerId=${playerId}`);
  };
</script>

<div class="min-h-screen bg-[#0d0d0d] text-white flex items-center justify-center">
  <div class="bg-neutral-900 p-6 rounded-lg shadow-lg w-full max-w-md space-y-4">
    <h1 class="text-xl font-bold mb-4">ðŸŽ® Join Prompt Quest</h1>
    <input
      class="w-full p-2 border border-neutral-600 rounded bg-neutral-800 text-white"
      placeholder="Enter your name"
      value={name()}
      onInput={(e) => setName(e.currentTarget.value)}
    />
    <input
      class="w-full p-2 border border-neutral-600 rounded bg-neutral-800 text-white"
      placeholder="Enter session ID"
      value={sessionId()}
      onInput={(e) => setSessionId(e.currentTarget.value)}
    />
    <button
      class="w-full bg-red-600 hover:bg-red-700 py-2 rounded-lg"
      onClick={handleJoin}
    >
      ðŸš€ Join Game
    </button>
  </div>
</div>
