---
import Card from "./Card/index.astro";
import Pulse from "./Pulse.astro";
import { getCurrentStatus } from "../lib/helpers";

const status = getCurrentStatus();

// Calculate percentage of day complete (for bar width)
const now = new Date();
const totalMinutes = now.getHours() * 60 + now.getMinutes();
const percentOfDay = Math.floor((totalMinutes / 1440) * 100);
---

<Card colSpan="md:col-span-1" rowSpan="md:row-span-1">
  <div class="h-full flex flex-col justify-start relative">
    <!-- Top-left: Heading -->
    <h2 class="text-lg font-semibold text-white mb-2">Live Feed</h2>

    <!-- Right-middle: Pulse absolutely positioned -->
    <div class="absolute right-4 top-1/2 -translate-y-1/2">
      <Pulse />
    </div>

    <!-- Status text -->
    <p class="text-sm text-white mb-2">{status}</p>

    <!-- Progress Bar -->
    <div class="h-2 bg-white/20 rounded-full overflow-hidden relative">
      <div
        class="h-full bg-white/30 rounded-full transition-all duration-700 relative"
        style={`width: ${percentOfDay}%`}
      >
        <div class="absolute inset-0 shimmer-glow rounded-full"></div>
      </div>
    </div>
  </div>
</Card>
